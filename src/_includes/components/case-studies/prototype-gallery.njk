<!-- Generic Prototype Gallery Component -->
<div class="case-study-section prototype-gallery-section">
  <h2>Prototype Gallery</h2>
  <p>Explore the app's design and flow through these key screens from the interactive prototype.</p>
  
  <div class="prototype-gallery">
    {% for image in galleryImages %}
    <div class="gallery-item" onclick="openLightbox({{ loop.index0 }})">
      <img src="{{ site.baseUrl }}assets/img/gallery-img/{{ projectKey }}/{{ image.src }}" alt="{{ image.alt | default('Prototype screen') }}" loading="lazy">
      <div class="gallery-overlay">
        <span>View Full Screen</span>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<!-- Lighbox Component -->
<div id="prototype-lightbox" class="lightbox-modal" onclick="closeLightbox(event)">
  <span class="lightbox-close" onclick="closeLightbox(event, true)">&times;</span>
  <span class="lightbox-nav prev" onclick="navigateLightbox(-1); event.stopPropagation();">&#10094;</span>
  <img class="lightbox-content" id="lightbox-img" src="" alt="Full Screen Prototype">
  <span class="lightbox-nav next" onclick="navigateLightbox(1); event.stopPropagation();">&#10095;</span>
</div>

<script>
  // Dynamic images passed from Eleventy frontmatter
  const galleryImages = [
    {% for image in galleryImages %}
    "{{ site.baseUrl }}assets/img/gallery-img/{{ projectKey }}/{{ image.src }}"{% if not loop.last %},{% endif %}
    {% endfor %}
  ];
  let currentImageIndex = 0;

  function openLightbox(index) {
    currentImageIndex = index;
    const lightbox = document.getElementById('prototype-lightbox');
    updateLightboxImage();
    lightbox.classList.add('active');
    document.body.style.overflow = 'hidden'; 
  }

  function updateLightboxImage() {
    const lightboxImg = document.getElementById('lightbox-img');
    if (galleryImages[currentImageIndex]) {
      lightboxImg.src = galleryImages[currentImageIndex];
    }
  }

  function navigateLightbox(direction) {
    currentImageIndex = (currentImageIndex + direction + galleryImages.length) % galleryImages.length;
    updateLightboxImage();
  }

  function closeLightbox(event, force = false) {
    if (force || event.target.id === 'prototype-lightbox') {
      const lightbox = document.getElementById('prototype-lightbox');
      lightbox.classList.remove('active');
      document.body.style.overflow = ''; 
      
      setTimeout(() => {
        if (!lightbox.classList.contains('active')) {
          document.getElementById('lightbox-img').src = '';
        }
      }, 300);
    }
  }
  
  document.addEventListener('keydown', function(event) {
    const lightbox = document.getElementById('prototype-lightbox');
    if (lightbox.classList.contains('active')) {
      if (event.key === "Escape") {
        closeLightbox(event, true);
      } else if (event.key === "ArrowLeft") {
        navigateLightbox(-1);
      } else if (event.key === "ArrowRight") {
        navigateLightbox(1);
      }
    }
  });
</script>
